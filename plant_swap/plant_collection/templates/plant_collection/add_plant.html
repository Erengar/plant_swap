{% extends "base.html" %}
{% block content %}
<style>
    output .image span {
        position: absolute;
        top: -4px;
        right: 4px;
        cursor: pointer;
        font-size: 22px;
        color: white;
      }
      
      output .image span:hover {
        opacity: 0.8;
      }
      
      output .span--hidden{
        visibility: hidden;
      }
</style>
<form enctype='multipart/form-data' class='box' action="{% url 'plant_collection:add_plant' %}" method='post'>
    {% csrf_token %}

        <div class='field'>
            <label class='label pt-3'>{{ form.nick_name.label_tag }}</label>
            <div class='control'>{{ form.nick_name }}</div>
        </div>
        {% if form.nick_name.errors %}
            <div>
                <ul>
                    {% for error in form.nick_name.errors %}
                        <li class='has-text-danger'>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <div class='field'>
            <label class='label pt-3'>{{ form.species.label_tag }}</label>
            <div class='control'>{{ form.species }}</div>
        </div>
        {% if form.species.errors %}
            <div>
                <ul>
                    {% for error in form.species.errors %}
                        <li class='has-text-danger'>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <div class='input_container'>
            <div class='field'>
                <div id='file-js-example' class='file is-medium'>
                    <label class='file-label pt-3'>
                        <input class='input_tag' hidden type='file' accept='image/*' name='picture'>
                        <span class='file-cta'>
                            <span class='file-icon'>
                                <i class='fa-solid fa-image'></i>
                            </span>
                            <span class='file-label'>
                                Upload image
                            </span>
                        </span>
                    </label>
                </div>
            </div>
        </div>

        {% if form.picture.errors %}
            <div>
                <ul>
                    {% for error in form.picture.errors %}
                        <li class='has-text-danger'>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    <div class='container'>
        <input id='submit-btn' class='button' type="submit" value='Submit'>
    </div>
</form>
<output class='columns'></output>

<script>
    const output = document.querySelector('output')
    var input = document.querySelector('.input_tag')
    const inputContainer = document.querySelector('.input_container')
    let count = 0
    let imagesArray = []


    inputContainer.addEventListener("change", () => {
        var files = input.files
        imagesArray.push(files)
        displayImages()
        addInput()
      })

    function addInput() {
        count ++
        const inputHtml = `<div class='field'>
                            <div id='file-js-example' class='file is-medium'>
                                <label class='file-label pt-3'>
                                    <input class='input_tag${count}' hidden type='file' accept='image/*' name='picture${count}'>
                                    <span class='file-cta'>
                                        <span class='file-icon'>
                                            <i class='fa-solid fa-image'></i>
                                        </span>
                                        <span class='file-label'>
                                            Upload image
                                        </span>
                                    </span>
                                </label>
                            </div>
                        </div>`
        inputContainer.innerHTML += inputHtml
        input = document.querySelector(`.input_tag${count}`);
    }

    function displayImages() {
        let images = "";
        imagesArray.forEach((image, index) => {
            for (let i = 0; i < image.length; i++) {
                images += `<div class='column is-3'>
                              <div class="image is-4by3">
                              <img src="${URL.createObjectURL(image[i])}" alt="image">
                              <span onclick="deleteImage(${index}, ${i})">&times;</span>
                            </div>
                            </div>`;
            }
        });
        output.innerHTML = images;
    }

    function deleteImage(index) {
        imagesArray.splice(index, 1)
        displayImages()
      }

  </script>
{% endblock %}